<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="yjc.wdb.mapper.PurchaseInfoMapper">


	<resultMap id="billInfo" type="java.util.HashMap">
		<result property="b_id" column="b_id" />
		<result property="publish_date" column="publish_date" />
		<result property="product_name" column="product_name" />
		<result property="user_id" column="user_id" />
		<result property="p_name" column="p_name" />
		<result property="totalPrice" column="totalPrice" />
	</resultMap>

	<resultMap id="billOne" type="java.util.HashMap">
		<result property="product_name" column="product_name" />
		<result property="amount" column="amount" />
		<result property="price" column="price" />
	</resultMap>

	<select id="billList" resultMap="billInfo">

		select b.b_id, b.publish_date,
		b.user_id, payway.p_name, sum(product.product_price * p.amount) as
		totalPrice
		from purchaseList p, product, bill b, payway
		where b.b_id = p.b_id and product.product_id = p.product_id and payway.p_id = b.p_id and b.user_id = #{user_id}
		and date(b.publish_date) >= date(subdate(curDate(), INTERVAL #{day} DAY))
		group by p.b_id;


	</select>

	<select id="billOne" resultMap="billOne">
		select product.product_name,
		p.amount, product.product_price *
		amount as price
		from purchaseList p,
		product, bill b
		where product.product_id =
		p.product_id and b.b_id =
		p.b_id and p.b_id = #{b_id}
		group by p.b_id,
		product.product_name;
	</select>
</mapper>